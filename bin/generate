#!/usr/bin/env ruby

require "yaml"
require "erb"

def main
  data = config[:profiles][profile]
  ensure_output_directory
  File.open(File.join("output", "#{profile}.html"), "w") do |file|
    file.write ERB.new(template).result(binding)
  end
end

def ensure_output_directory
  Dir.mkdir("output") unless Dir.exist?("output")
end

def template
  File.read("templates/index.html.erb")
end

def config
  @config ||= YAML.load(File.open("config.yml"))
end

def profile
  @profile ||= get_profile
end

def get_profile
  fail "Must select a profile: `bin/generate <profile>`" unless ARGV[0]
  unless config[:profiles].key?(ARGV[0].to_sym)
    fail "Invalid profile: must be one of #{config[:profiles].keys.map(&:to_s).inspect}"
  end
  ARGV[0].to_sym
end

main
